<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Clinica Veterinaria Rodriguez</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/index.css}">
    <link rel="icon" th:href="@{/img/portadafondo.png}">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto:wght@300;500&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <style>
        .header-bg {
            background-color: #e0b0ff;
            color: #4b0082;
            padding: 15px 0;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .pet-card {
            border: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .pet-card:hover {
            transform: translateY(-5px);
        }
        .pet-card img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            margin-bottom: 10px;
        }
    </style>
    <title>Historial Clínico</title>
</head>
<body>
    <header>
         <div th:replace="fragments/navbar :: navbar"></div>
    </header> 

<div class="card p-4 my-4 custom-main-card"> 
    <div class="container my-4">
        
            <h1 class="mb-0 fw-bold">Historial Clínico</h1>
       

        <div th:if="${mensaje}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${mensaje}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-4">
            <button type="button" class="btn" style="background-color: #4b0082; color: white;" data-bs-toggle="modal" data-bs-target="#modalRegistroMascota">
                Registrar Nueva Mascota
            </button>
            
            <form th:action="@{/historial_clinico}" method="get" class="d-flex">
                <input type="text" name="search" class="form-control me-2" placeholder="Buscar por nombre de mascota" th:value="${param.search}">
                <button type="submit" class="btn btn-outline-primary">Buscar</button>
            </form>
        </div>

        <h3>Mascotas Registradas</h3>
        <div th:if="${mascotas.isEmpty()}" class="alert alert-info">
            No hay mascotas registradas aún.
        </div>

        <div th:unless="${mascotas.isEmpty()}" class="row">
            <div class="col-md-4 col-lg-3 mb-4" th:each="mascota : ${mascotas}">
                <div class="card pet-card text-center p-3">
                    <img th:src="@{${mascota.rutaFoto}}" alt="Foto de Mascota" class="mx-auto">
                    <h5 class="card-title mt-2" th:text="${mascota.nombre}">Nombre Mascota</h5>
                    <p class="card-text text-muted" th:text="${mascota.especie}"></p>
                    <div class="d-flex justify-content-around mt-2">
                        <a th:href="@{/historial_clinico/detalles/{id}(id=${mascota.id})}" class="btn btn-sm btn-info">Detalles</a>
                        <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" th:data-bs-target="'#modalEliminarMascota' + ${mascota.id}">
                            Eliminar
                        </button>
                    </div>
                </div>
                
                <div class="modal fade" th:id="modalEliminarMascota + ${mascota.id}" tabindex="-1" aria-labelledby="modalEliminarMascotaLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalEliminarMascotaLabel">Confirmar Eliminación</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                ¿Estás seguro de que quieres eliminar a la mascota <strong th:text="${mascota.nombre}"></strong> y todo su historial? Esta acción es irreversible.
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                <form th:action="@{/historial_clinico/eliminar_mascota/{id}(id=${mascota.id})}" method="post">
                                    <button type="submit" class="btn btn-danger">Eliminar Mascota</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
 
    <div class="modal fade" id="modalRegistroMascota" tabindex="-1" aria-labelledby="modalRegistroMascotaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalRegistroMascotaLabel">Registrar Nueva Mascota</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form th:action="@{/historial_clinico/registrar_mascota}" method="post" enctype="multipart/form-data" th:object="${nuevaMascota}">
                    <div class="modal-body">
                        <h6 class="text-uppercase fw-bold mb-3">Datos del Paciente</h6>
                        <div class="row g-3 mb-4">
                            <div class="col-md-4"><label for="nombre" class="form-label">Nombre:</label><input type="text" th:field="*{nombre}" class="form-control" required></div>
                            <div class="col-md-4"><label for="sexo" class="form-label">Sexo:</label><select th:field="*{sexo}" class="form-select"><option value="Macho">Macho</option><option value="Hembra">Hembra</option></select></div>
                            <div class="col-md-4"><label for="peso" class="form-label">Peso (kg):</label><input type="number" step="0.1" th:field="*{peso}" class="form-control"></div>
                            <div class="col-md-4"><label for="especie" class="form-label">Especie:</label><input type="text" th:field="*{especie}" class="form-control"></div>
                            <div class="col-md-4"><label for="edad" class="form-label">Edad (años):</label><input type="number" th:field="*{edad}" class="form-control"></div>
                            <div class="col-md-4"><label for="esterilizado" class="form-label">Esterilizado:</label><select th:field="*{esterilizado}" class="form-select"><option value="true">Sí</option><option value="false">No</option></select></div>
                            <div class="col-md-4"><label for="raza" class="form-label">Raza:</label><input type="text" th:field="*{raza}" class="form-control"></div>
                            <div class="col-md-4"><label for="color" class="form-label">Color:</label><input type="text" th:field="*{color}" class="form-control"></div>
                            <div class="col-md-4"><label for="medicinaPreventiva" class="form-label">Medicina Preventiva:</label><input type="text" th:field="*{medicinaPreventiva}" class="form-control"></div>
                        </div>

                        <h6 class="text-uppercase fw-bold mb-3">Datos del Dueño</h6>
                        <div class="row g-3 mb-4">
                            <div class="col-md-4"><label for="nombreDueno" class="form-label">Nombre:</label><input type="text" th:field="*{nombreDueno}" class="form-control"></div>
                            <div class="col-md-4"><label for="telefonoDueno" class="form-label">Teléfono:</label><input type="text" th:field="*{telefonoDueno}" class="form-control"></div>
                            <div class="col-md-4"><label for="direccionDueno" class="form-label">Dirección:</label><input type="text" th:field="*{direccionDueno}" class="form-control"></div>
                        </div>

                        <h6 class="text-uppercase fw-bold mb-3">Foto de la Mascota</h6>
                        <div class="mb-3">
                            <label for="fotoMascota" class="form-label">Seleccionar Foto:</label>
                            <input class="form-control" type="file" id="fotoMascota" name="fotoMascota" accept="image/*">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn" style="background-color: #4b0082; color: white;">Registrar Mascota</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
  
    <script>
        // Script para cargar los datos en el modal de edición de atención
        document.addEventListener('DOMContentLoaded', function() {
            var editAttentionModals = document.querySelectorAll('.modal-edit-attention');
            editAttentionModals.forEach(function(modalElement) {
                modalElement.addEventListener('show.bs.modal', function (event) {
                    var button = event.relatedTarget; // Botón que activó el modal
                    var attentionId = button.getAttribute('data-attention-id');
                    var date = button.getAttribute('data-attention-date');
                    var diagnostico = button.getAttribute('data-attention-diagnostico');
                    var tratamiento = button.getAttribute('data-attention-tratamiento');
                    var temperatura = button.getAttribute('data-attention-temperatura');
                    var pulso = button.getAttribute('data-attention-pulso');
                    var llenadoCapilar = button.getAttribute('data-attention-llenado-capilar');
                    var fr = button.getAttribute('data-attention-fr');
                    var pruebas = button.getAttribute('data-attention-pruebas');

                    var modalBodyInputDate = modalElement.querySelector('#editFechaAtencion');
                    var modalBodyInputDiagnostico = modalElement.querySelector('#editDiagnostico');
                    var modalBodyInputTratamiento = modalElement.querySelector('#editTratamiento');
                    var modalBodyInputTemperatura = modalElement.querySelector('#editTemperatura');
                    var modalBodyInputPulso = modalElement.querySelector('#editPulso');
                    var modalBodyInputLlenadoCapilar = modalElement.querySelector('#editLlenadoCapilar');
                    var modalBodyInputFr = modalElement.querySelector('#editFr');
                    var modalBodyInputPruebas = modalElement.querySelector('#editPruebasRealizadas');
                    var modalForm = modalElement.querySelector('form');

                    modalBodyInputDate.value = date;
                    modalBodyInputDiagnostico.value = diagnostico;
                    modalBodyInputTratamiento.value = tratamiento;
                    modalBodyInputTemperatura.value = temperatura;
                    modalBodyInputPulso.value = pulso;
                    modalBodyInputLlenadoCapilar.value = llenadoCapilar;
                    modalBodyInputFr.value = fr;
                    modalBodyInputPruebas.value = pruebas;
                    modalForm.action = '/historial_clinico/editar_atencion/' + attentionId;
                });
            });
        });
        
    </script>
    <footer>
        <p>&copy; 2025 Veterinaria Rodriguez. Todos los derechos reservados.</p>
    </footer>
    <script th:src="@{/js/animacion.js}"></script>
    <script th:src="@{/js/script.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
</body>
</html>